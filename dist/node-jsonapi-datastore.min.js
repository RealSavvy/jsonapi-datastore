!function(){"use strict";function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}(),n=function(){function n(i,e){t(this,n),this.id=e,this._type=i,this._attributes=[],this._relationships=[],this._links=[]}return i(n,[{key:"serialize",value:function(t){var i=this,n={data:{type:this._type}};return t=t||{},t.attributes=t.attributes||this._attributes,t.relationships=t.relationships||this._relationships,t.links=t.links||this._links,void 0!==this.id&&(n.data.id=this.id),0!==t.attributes.length&&(n.data.attributes={}),0!==t.relationships.length&&(n.data.relationships={}),0!==t.links.length&&(n.data.links={}),t.attributes.forEach(function(t){n.data.attributes[t]=i[t]}),t.relationships.forEach(function(t){function e(t){return{type:t._type,id:t.id}}i[t]?i[t].constructor===Array?n.data.relationships[t]={data:i[t].map(e)}:n.data.relationships[t]={data:e(i[t])}:n.data.relationships[t]={data:null}}),t.links.forEach(function(t){n.data.links[t]=i[t]}),n}},{key:"setAttribute",value:function(t,i){void 0===this[t]&&this._attributes.push(t),this[t]=i}},{key:"setRelationship",value:function(t,i){void 0===this[t]&&this._relationships.push(t),this[t]=i}}]),n}(),e=function(){function e(){t(this,e),this.graph={}}return i(e,[{key:"destroy",value:function(t){delete this.graph[t._type][t.id]}},{key:"find",value:function(t,i){return this.graph[t]&&this.graph[t][i]?this.graph[t][i]:null}},{key:"findAll",value:function(t){var i=this;return this.graph[t]?Object.keys(i.graph[t]).map(function(n){return i.graph[t][n]}):[]}},{key:"reset",value:function(){this.graph={}}},{key:"initModel",value:function(t,i){return this.graph[t]=this.graph[t]||{},this.graph[t][i]=this.graph[t][i]||new n(t,i),this.graph[t][i]}},{key:"syncRecord",value:function(t){function i(t){if(!e.find(t.type,t.id)){var i=e.initModel(t.type,t.id);i._placeHolder=!0}return e.graph[t.type][t.id]}var n,e=this,a=this.initModel(t.type,t.id);delete a._placeHolder;for(n in t.attributes)a._attributes.indexOf(n)===-1&&a._attributes.push(n),a[n]=t.attributes[n];if(t.relationships)for(n in t.relationships){var s=t.relationships[n];void 0!==s.data&&(a._relationships.push(n),null===s.data?a[n]=null:s.data.constructor===Array?a[n]=s.data.map(i):a[n]=i(s.data)),s.links&&console.log("Warning: Links not implemented yet.")}a.__links={};for(n in t.links)a._links.indexOf(n)===-1&&a._links.push(n),a.__links[n]=t.links[n];return a}},{key:"syncWithMeta",value:function(t){var i=t.data,n=this.syncRecord.bind(this);return i?(t.included&&t.included.map(n),{data:i.constructor===Array?i.map(n):n(i),meta:"meta"in t?t.meta:null}):[]}},{key:"sync",value:function(t){return this.syncWithMeta(t).data}}]),e}();"undefined"!=typeof module&&(module.exports={JsonApiDataStore:e,JsonApiDataStoreModel:n}),exports.JsonApiDataStore=e,exports.JsonApiDataStoreModel=n}();